<!DOCTYPE html>
<html lang="en" class="bg-neutral-950 text-gray-100 font-Figtree">
  <head>
    <meta charset="UTF-8" />
    <title><%= name %> - Nodes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>
  <style>
  .input {
    width: 100%;
    background: #0a0a0a;
    border: 1px solid #262626;
    padding: 0.5rem 0.75rem;
    border-radius: 0.75rem;
  }

  @keyframes heartbeat {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.3); opacity: 0.6; }
    100% { transform: scale(1); opacity: 1; }
  }

  .heartbeat {
    animation: heartbeat 2s infinite;
  }
</style>


  <body class="min-h-screen flex">
    <%- include('../components/sidebar', { name, user }) %>

    <main class="flex-1 p-8 overflow-auto">
      <div class="max-w-6xl mx-auto space-y-6">
        <div
          class="bg-neutral-950 border border-neutral-900 p-6 rounded-2xl flex justify-between items-center"
        >
          <div>
            <h1 class="text-3xl font-bold">ðŸ–¥ Nodes</h1>
            <p class="text-gray-400">Manage all connected nodes</p>
          </div>

          <button
            onclick="openCreateModal()"
            class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-xl font-medium"
          >
            + Create Node
          </button>
        </div>

      <div class="bg-neutral-900 border border-neutral-800 rounded-2xl overflow-hidden">
  <table class="w-full text-left">
    <thead class="bg-neutral-950 border-b border-neutral-800">
      <tr class="text-gray-400 text-sm">
        <th class="p-4">Status</th>
        <th class="p-4">Name</th>
        <th class="p-4">IP</th>
        <th class="p-4">CPU</th>
        <th class="p-4">RAM</th>
        <th class="p-4 text-right">Actions</th>
      </tr>
    </thead>

    <tbody>
      <% nodes.forEach(node => { %>
        <tr class="border-b border-neutral-800 hover:bg-neutral-800/50 transition">

          <!-- STATUS -->
          <td class="p-4">
            <% if (node.status === "online") { %>
              <span class="flex items-center gap-2 text-green-400">
                <i data-lucide="heart-pulse" class="w-4 h-4 heartbeat"></i>
              </span>
            <% } else if (node.status === "dockernotrunning") { %>
              <span class="flex items-center gap-2 text-yellow-400">
                <i data-lucide="alert-triangle" class="w-4 h-4"></i>
              </span>
            <% } else { %>
              <span class="flex items-center gap-2 text-red-400">
                <i data-lucide="x-circle" class="w-4 h-4"></i>
              </span>
            <% } %>
          </td>

          <!-- NAME -->
          <td class="p-4 font-medium">
            <%= node.name %>
          </td>

          <!-- IP -->
          <td class="p-4 text-gray-400">
            <%= node.ip %>:<%= node.port %>
          </td>

          <!-- CPU -->
          <td class="p-4 text-gray-400">
            <i data-lucide="cpu" class="inline w-4 h-4 mr-1"></i>
            <%= node.core %>
          </td>

          <!-- RAM -->
          <td class="p-4 text-gray-400">
            <i data-lucide="memory-stick" class="inline w-4 h-4 mr-1"></i>
            <%= node.ram %> MB
          </td>

          <!-- ACTIONS -->
          <td class="p-4 text-right">
            <a
              href="/admin/node/<%= node.id %>"
              class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 px-3 py-1.5 rounded-xl text-sm"
            >
              <i data-lucide="settings" class="w-4 h-4"></i>
              Manage
            </a>
          </td>

        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

      </div>
    </main>
    <!-- Create Node Modal -->
    <div
      id="createModal"
      class="fixed inset-0 bg-black/60 hidden items-center justify-center z-50"
    >
      <div
        class="bg-neutral-900 border border-neutral-800 rounded-2xl p-6 w-full max-w-md"
      >
        <h2 class="text-xl font-semibold mb-4">Create Node</h2>

        <div class="space-y-3">
          <input id="n-name" placeholder="Node Name" class="input" />
          <input id="n-ip" placeholder="IP (or localhost)" class="input" />
          <input id="n-port" placeholder="Port" class="input" />
          <input id="n-ram" placeholder="RAM (MB)" class="input" />
          <input id="n-core" placeholder="CPU Cores" class="input" />
        </div>

        <div class="flex justify-end gap-2 mt-6">
          <button onclick="closeCreateModal()" class="px-4 py-2 text-gray-400">
            Cancel
          </button>
          <button
            onclick="createNode()"
            class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-xl"
          >
            Create
          </button>
        </div>
      </div>
    </div>

    <script>
      lucide.createIcons();
    </script>
    <script>
      function openCreateModal() {
        document.getElementById("createModal").classList.remove("hidden");
        document.getElementById("createModal").classList.add("flex");
      }

      function closeCreateModal() {
        document.getElementById("createModal").classList.add("hidden");
        document.getElementById("createModal").classList.remove("flex");
      }

      async function createNode() {
        const body = {
          name: document.getElementById("n-name").value,
          ip: document.getElementById("n-ip").value,
          port: document.getElementById("n-port").value,
          ram: document.getElementById("n-ram").value,
          core: document.getElementById("n-core").value,
        };

        const res = await fetch("/admin/node/create", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body),
        });

        if (res.ok) location.reload();
        else alert("Failed to create node");
      }
    </script>
  </body>
</html>

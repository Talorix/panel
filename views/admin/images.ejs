<!DOCTYPE html>
<html lang="en" class="bg-neutral-950 text-gray-100 font-Figtree">
<head>
  <meta charset="UTF-8">
  <title><%= name %> - Images</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="min-h-screen flex">
  <%- include('../components/sidebar', { name, user }) %>

  <main class="flex-1 p-8 overflow-auto">
    <div class="max-w-6xl mx-auto space-y-6">
      <div class="bg-neutral-950 border border-neutral-900 p-6 rounded-2xl flex justify-between items-center">
        <h1 class="text-3xl font-bold">ðŸ–¼ Docker Images</h1>
        <a href="/admin/images/new" class="bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded-xl font-medium">+ New Image</a>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <% images.forEach(img => { %>
        <div class="bg-neutral-900 border border-neutral-800 rounded-2xl p-6 flex flex-col justify-between">
          <div>
            <h2 class="text-xl font-semibold mb-2"><%= img.name %></h2>
            <p class="text-gray-400 text-sm mb-1"><strong>Docker Image:</strong> <%= img.dockerImage %></p>
            <p class="text-gray-400 text-sm mb-1"><%= img.description %></p>
            <p class="text-gray-400 text-sm mb-1"><strong>ENVs:</strong> <%= JSON.stringify(img.envs) %></p>
            <% if (img.files.length) { %>
              <p class="text-gray-400 text-sm"><strong>Files:</strong></p>
              <ul class="list-disc list-inside text-gray-400 text-sm">
                <% img.files.forEach(file => { %>
                  <li><a href="<%= file.url %>" class="text-indigo-400 hover:underline"><%= file.filename %></a></li>
                <% }) %>
              </ul>
            <% } %>
          </div>
          <div class="mt-4 flex justify-end gap-2">
            <button onclick="deleteImage('<%= img.id %>')" class="flex items-center gap-2 bg-red-600 hover:bg-red-700 px-3 py-1 rounded-xl text-sm">
              <i data-lucide="trash-2" class="w-4 h-4"></i> Delete
            </button>
          </div>
        </div>
        <% }) %>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    lucide.createIcons();

    async function deleteImage(id) {
      if (!confirm("Are you sure you want to delete this image?")) return;
      try {
        const res = await axios.post(`/admin/images/delete/${id}`);
        if (res.data.success) location.reload();
      } catch (err) {
        alert("Failed to delete image");
      }
    }
  </script>
</body>
</html>
